#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Enhanced commit message validation using Node.js
echo "🔍 Running enhanced commit message validation..."

# Check if Node.js is available
if ! command -v node >/dev/null 2>&1; then
    echo "❌ Node.js is required for commit message validation"
    exit 1
fi

# Run commit message validation
if ! node scripts/docs/commit-msg-validator.js "$1"; then
    echo "❌ Commit message validation failed"
    echo "💡 Check the validation output above for issues"
    exit 1
fi

# Check for documentation changes
if git diff --cached --name-only | grep -q "\.md$"; then
    echo "📝 Documentation changes detected"
    
    # Check if commit message includes task ID for documentation changes
    if ! grep -qE "\(T[0-9]{3}\)" "$1"; then
        echo "⚠️  Warning: Documentation changes should include task ID (e.g., (T001))"
        echo "   This helps track documentation automation progress"
    fi
fi

echo "✅ Commit message validation passed"

